import intro;
import location as loc;



function afterTriggerExec() {
    intro.introLoop();

    foreach(ptr, epd : EUDLoopUnit()) {
        const unitType = dwread_epd(epd + (0x64 / 4));
        if(unitType == $U('Basic Builder')) {
            const player = dwbreak(dwread_epd(epd + 0x4C))[[2]];
            var opponentPlayer = ($P1 <= player && player <= $P3) ? $P8 : $P7;
            const position = dwread_epd(epd + (0x28 / 4));
            const posX, posY = dwbreak(position)[[0, 1]];
            loc.pxMoveLocation(posX, posY);
            MoveLocation('ptrace', 'Map Revealer', P12, 'pxmove');

            if(Bring(opponentPlayer, AtLeast, 1, '(men)', 'ptrace')) {
                KillUnit('Basic Builder', player);
                KillUnitAt(1, '(men)', 'ptrace', opponentPlayer);
                SetCurrentPlayer(player);
                DisplayText("\x16적의 미사일이 명중하였습니다.\r\n\r\n\x16부품이 수리될때까지 기다려주세요.");
            }
        }
    }

    SetInvincibility(Enable, '(any unit)', AllPlayers, 'Anywhere');
}
